/*
 * DCCChannelSnd.h
 *
 *  Created on: 2013-6-28
 *      Author: Administrator
 */

#ifndef DCCCHANNELSND_H_
#define DCCCHANNELSND_H_

#include "EZ_types.h"
#include <map>
#include "os.h"

class SwitchPortInner;

class DCCChannelSnd {
	DCCChannelSnd();
public:
	DCCChannelSnd(uint32 id, uint32 OptPortID);
	virtual ~DCCChannelSnd();

	virtual void sendData(uint8* d, uint32 len) = 0;

	uint32 getUID(void) {
		return uid;
	};

	uint32 getBelongOPTPortUID(void) {
	    return belongPort;
	};
    void setInnerPort(SwitchPortInner* p) {
        port = p;
    };

    SwitchPortInner* getInnerPort(void) {
        return port;
    };
	static DCCChannelSnd* getSendDccByUID(uint32 uid) {
		std::map<uint32, DCCChannelSnd*>::iterator it = DccSendMap.find(uid);
		if( it != DccSendMap.end() ) {
			return it->second;
		}
		return 0;
	};

	static DCCChannelSnd* getFirstSndDcc(void) {
		std::map<uint32, DCCChannelSnd*>::iterator it = DccSendMap.begin();
		if( it != DccSendMap.end() ) {
			return it->second;
		}
		return 0;
	};
	static DCCChannelSnd* getNextSndDcc(uint32 uid) {
		std::map<uint32, DCCChannelSnd*>::iterator it = DccSendMap.find(uid);
		if( it != DccSendMap.end() ) {
			++it;
			if( it != DccSendMap.end() ) {
				return it->second;
			}
		}
		return 0;
	};

private:
	uint32 uid;
    uint32 belongPort;
	OS_MUT mut_send_protect;
    SwitchPortInner* port;
	static std::map<uint32, DCCChannelSnd*> DccSendMap;
};

#endif /* DCCCHANNELSND_H_ */
